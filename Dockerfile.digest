# ---------- BASE IMAGE ----------
FROM ollama/ollama:latest

# ---------- SYSTEM SETUP ----------
WORKDIR /app
COPY . /app

# Install Python and dependencies
RUN apt-get update && apt-get install -y python3 python3-pip && \
    pip install --no-cache-dir -r requirements-optimized.txt

# Expose Ollama API port
EXPOSE 11434

# ---------- STARTUP COMMAND ----------
# Start Ollama, wait for readiness, then run your digest job
CMD ["sh", "-c", "\
ollama serve & \
sleep 10 && \
echo 'ðŸŸ¢ Starting Ollama model pull...' && \
ollama pull gemma3:1b && \
echo 'âœ… Model ready. Starting News Digest service...' && \
python /app/app/send_digest.py"]
