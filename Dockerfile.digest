# Dockerfile.digest
FROM ollama/ollama:latest

# install minimal packages for Python and curl
RUN apt-get update && \
    apt-get install -y --no-install-recommends python3-venv python3-distutils curl bash && \
    rm -rf /var/lib/apt/lists/*

WORKDIR /app

# copy repo (adjust if you only want some folders)
COPY . /app

# create and activate a virtualenv to avoid system pip conflicts (PEP 668)
RUN python3 -m venv /opt/venv
ENV PATH="/opt/venv/bin:$PATH"

# upgrade pip inside venv and install deps
# use requirements-lock.txt (as you have) â€” adjust filename if necessary
RUN pip install --upgrade pip setuptools wheel && \
    pip install --no-cache-dir -r requirements-lock.txt

# copy entrypoint script
COPY docker-entrypoint.sh /usr/local/bin/docker-entrypoint.sh
RUN chmod +x /usr/local/bin/docker-entrypoint.sh

# Ollama default listen port (internal)
EXPOSE 11434

ENTRYPOINT ["/usr/local/bin/docker-entrypoint.sh"]
